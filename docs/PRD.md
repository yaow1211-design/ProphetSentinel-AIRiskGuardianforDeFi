# 🧠 Prophet Sentinel — 产品需求文档 (PRD)

**版本：** v1.0  
**撰写日期：** 2025-10-21  
**负责人：** [项目发起人姓名或团队名]  
**目标提交日期：** 2025-10-30  
**用途：** 提供开发团队在10天内完成Demo原型的完整技术与功能规范。

---

## 1. 🎯 项目背景与目标

### 背景
2025年DeFi市场 rug pull 与闪崩事件造成超15亿美元损失。现有审计与风控多为静态报告，无法应对高频链上风险。

### 目标
构建一个 **实时AI风险预测引擎（“预言家”模型）**，结合隐私保护、可视化与即时警报，成为“链上哨兵系统”。

- 提供实时“风险分数”（0–100）
- 支持Telegram即时警报
- 支持匿名风险验证（zk-proof）
- 提供绿色能耗与可持续性指标
- 开源与社区反馈机制，持续演进模型

---

## 2. 🧩 系统概览架构

```plaintext
┌────────────────────────┐
│  用户前端 Dashboard     │
│  (React + Chart.js)     │
│   ├── 风险热图           │
│   ├── 可持续得分展示     │
│   └── 钱包连接 (Phantom) │
└──────────┬──────────────┘
           │ REST API
┌──────────▼──────────────┐
│ Flask 后端 + 模型服务     │
│  /predict_risk API       │
│   ├── ML模型 (RF/LSTM)   │
│   ├── Solana链上数据拉取  │
│   ├── zk摘要验证模块     │
│   └── ESG能耗计算模块    │
└──────────┬──────────────┘
           │
┌──────────▼──────────────┐
│ Telegram Bot (Telegraf) │
│   ├── /risk 命令查询      │
│   ├── 风险推送订阅        │
│   └── 报警自动发送        │
└──────────┬──────────────┘
           │
┌──────────▼──────────────┐
│ Solana 网络 / Helius API │
│ 拉取Jupiter/Orca链上指标  │
│ e.g. 流动性、交易量、鲸鱼转移 │
└──────────────────────────┘
````

---

## 3. ⚙️ 核心功能模块说明

### 3.1 模块1：AI 预言家模型（风险预测引擎）

| 项目      | 说明                                       |
| ------- | ---------------------------------------- |
| **输入**  | 交易量、流动性变化、鲸鱼钱包行为、Token分布等链上指标            |
| **输出**  | 风险分数（0–100）与风险等级标签（低、中、高）                |
| **算法**  | Random Forest（初版） / LSTM（可选）             |
| **数据源** | Dune Analytics历史CSV + Solana实时RPC数据      |
| **目标**  | 在1分钟内输出最新风险分数，支持what-if模拟（如“加仓Jupiter?”） |

**伪代码示例：**

```python
model = RandomForestClassifier()
model.fit(X_train, y_train)
risk_score = model.predict_proba(new_data)[0][1] * 100
```

---

### 3.2 模块2：后端 API 服务（Flask）

| 项目       | 说明                               |
| -------- | -------------------------------- |
| **框架**   | Flask + solana-py                |
| **接口**   | `/predict_risk?protocol=Jupiter` |
| **返回格式** | JSON                             |
| **说明**   | 负责对接模型预测与Solana数据查询，提供标准化API输出   |

**返回示例：**

```json
{
  "protocol": "Jupiter",
  "risk_score": 82,
  "alert_level": "high",
  "sustainable_score": 93,
  "timestamp": "2025-10-21T12:35:00Z"
}
```

---

### 3.3 模块3：前端 Dashboard（React）

| 项目       | 说明                            |
| -------- | ----------------------------- |
| **框架**   | React + Chart.js / Recharts   |
| **功能**   | 展示风险热图（协议 vs 风险分数），支持用户自定义阈值  |
| **附加特性** | Phantom钱包连接、匿名模式、不存储用户数据      |
| **展示形式** | 风险热区颜色渐变（绿色→红色） + 实时刷新（30s间隔） |

---

### 3.4 模块4：Telegram Bot 警报系统

| 项目       | 说明                                            |
| -------- | --------------------------------------------- |
| **框架**   | Telegraf.js                                   |
| **命令**   | `/risk [protocol]` 查询风险； `/subscribe` 订阅高风险推送 |
| **推送示例** | “🚨 Jupiter流动性骤降 -30%，当前风险分数 87，建议撤离”         |
| **触发机制** | Flask webhook推送 + Bot群发订阅机制                   |

---

### 3.5 模块5：隐私黑箱分析（zk-proof）

| 项目     | 说明                                     |
| ------ | -------------------------------------- |
| **目的** | 用户在分析风险时，不暴露完整钱包历史                     |
| **方案** | 使用 zk-SNARK / Semaphore 生成加密摘要，验证结果正确性 |
| **输出** | `proof_hash` + `verified: true/false`  |
| **备注** | MVP阶段可伪实现（仅展示验证逻辑）                     |

---

### 3.6 模块6：绿色优化（Sustainability Score）

| 项目       | 说明                       |
| -------- | ------------------------ |
| **目标**   | 计算Solana协议交互的碳足迹并生成可持续得分 |
| **计算公式** |                          |

```
sustainable_score = 100 - (TPS * energy_per_tx / norm_factor)
```

| **结果输出** | ESG友好度提示 + 推荐低能耗替代协议 |
| **数据来源** | Solana PoH能耗模型参数 |

---

### 3.7 模块7：社区进化与反馈机制

| 项目       | 说明                             |
| -------- | ------------------------------ |
| **功能**   | 用户可提交预测误差反馈，奖励“哨兵积分”           |
| **实现**   | Streamlit表单 + GitHub issue API |
| **用途**   | 模型迭代与数据标注                      |
| **未来扩展** | DAO化积分奖励机制                     |

---

## 4. 🔌 技术规格与接口定义

### 4.1 API Schema

| 接口                 | 方法   | 参数                     | 返回                     |
| ------------------ | ---- | ---------------------- | ---------------------- |
| `/predict_risk`    | GET  | `protocol` (string)    | 风险与ESG分数               |
| `/subscribe_alert` | POST | `chat_id`, `threshold` | 订阅成功                   |
| `/verify_proof`    | POST | `wallet_hash`, `proof` | `verified: true/false` |

---

## 5. 💡 非功能性需求

| 项目   | 要求                        |
| ---- | ------------------------- |
| 响应时间 | < 2 秒（预测请求）               |
| 更新频率 | 每分钟刷新一次链上指标               |
| 隐私性  | 不存储钱包原始交易数据               |
| 开源协议 | MIT License               |
| 成本   | 免费API优先（Helius Free Tier） |
| 安全性  | 防止API滥用与速率限制              |

---

## 6. 🗓️ 开发时间表（10天Solo计划）

| 日期       | 阶段                         | 输出                |
| -------- | -------------------------- | ----------------- |
| 10/20–21 | ML模型原型 + 数据清洗              | Python脚本 + 模型.pkl |
| 10/22–23 | Flask API + RPC集成          | 可预测API            |
| 10/24–25 | 前端Dashboard + Telegram Bot | React热图 + Bot演示   |
| 10/26–27 | Solana合约 + 钱包集成            | 合约部署 + 调用验证       |
| 10/28–29 | Pitch准备 + Demo视频录制         | Loom视频 + README   |
| 10/30    | 提交评审                       | 完整Demo上线          |

---

## 7. 📦 交付清单

| 交付内容              | 说明          |
| ----------------- | ----------- |
| `ml_model.py`     | 训练与推理脚本     |
| `app.py`          | Flask后端主程序  |
| `frontend/`       | React项目目录   |
| `telegram_bot.js` | 警报Bot脚本     |
| `zk_demo.py`      | 隐私验证伪实现     |
| `README.md`       | 总结说明文档      |
| `demo_video.mp4`  | 功能演示视频      |
| `context_store/`  | Cursor上下文配置 |

---

## 8. 🔮 成功指标（KPI）

| 指标           | 目标             |
| ------------ | -------------- |
| 平均预测准确率      | ≥ 80%（基于历史测试集） |
| 用户损失降低率      | ≥ 20%          |
| Telegram响应时延 | < 2 秒          |
| MVP总代码行数     | < 300 行        |
| 评审通过率        | ≥ 35%（参考历届获奖率） |

---

## 9. 🚀 Pitch核心信息（简短稿）

> “在DeFi丛林，我是你的数据哨兵：
> AI预言 + 隐私盾 + 即时救赎，
> 让用户在闪崩前撤离，在风险中先知。
> 我们拯救的不只是资金，更是信任。”

---

## 10. 📚 技术栈总览

| 层级      | 技术                                      |
| ------- | --------------------------------------- |
| 数据 & 模型 | Python, Pandas, scikit-learn            |
| 后端      | Flask, solana-py, Helius API            |
| 前端      | React, Recharts, Phantom Wallet Adapter |
| 通知      | Node.js, Telegraf.js                    |
| 隐私      | Semaphore / zk-SNARK (伪实现)              |
| DevOps  | GitHub Actions, Streamlit Feedback      |
| 区块链     | Solana Devnet, Anchor (可选)              |

---

## 11. ⚠️ 风险与缓解措施

| 风险         | 影响      | 缓解方案         |
| ---------- | ------- | ------------ |
| 链上数据延迟     | 预测不准确   | 使用Helius缓存机制 |
| zk模块复杂度    | 开发周期拖延  | 使用伪实现展示概念    |
| Telegram限流 | Bot推送失败 | 增加限频与重发机制    |
| 模型过拟合      | 偏差大     | 用Dune多样化历史数据 |
| 前端部署延迟     | Demo不完整 | 优先录制本地运行视频   |

---

**版本控制说明：**

* v1.0 初版 — 建立全栈功能需求
* v1.1（提交后）可扩展 zk/DAO 模块

