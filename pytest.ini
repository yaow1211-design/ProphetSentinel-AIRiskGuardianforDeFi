[pytest]
# Pytest 配置文件 | Pytest Configuration
# Prophet Sentinel Test Suite

# ==================== 路径配置 | Path Configuration ====================
# Python 路径设置
pythonpath = . backend

# 测试目录
testpaths = tests

# ==================== 测试发现 | Test Discovery ====================
# 测试文件命名模式
python_files = test_*.py *_test.py

# 测试类命名模式
python_classes = Test* *Tests

# 测试函数命名模式
python_functions = test_*

# ==================== 输出选项 | Output Options ====================
addopts = 
    -v
    --tb=short
    --strict-markers
    --strict-config
    -ra
    --showlocals
    --maxfail=5

# ==================== 日志配置 | Logging Configuration ====================
# 控制台日志
log_cli = false
log_cli_level = WARNING
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s - %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# 文件日志
log_file = logs/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(name)s:%(lineno)d - %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# 捕获日志
log_level = INFO

# ==================== 覆盖率配置 | Coverage Configuration ====================
# 使用 --cov 时的默认选项
# 运行: pytest --cov
# 这些选项将自动应用

# ==================== 标记 | Markers ====================
markers =
    unit: 单元测试 (Unit tests)
    integration: 集成测试 (Integration tests)
    e2e: 端到端测试 (End-to-end tests)
    slow: 慢速测试 (Slow running tests)
    api: API 相关测试 (API related tests)
    model: 模型相关测试 (Model related tests)
    smoke: 冒烟测试 (Smoke tests)
    regression: 回归测试 (Regression tests)
    security: 安全测试 (Security tests)

# ==================== 性能配置 | Performance Configuration ====================
# 超时设置（需要安装 pytest-timeout）
# timeout = 300

# 并行测试（需要安装 pytest-xdist）
# addopts = -n auto

# ==================== 忽略 | Ignore ====================
# 忽略的目录和文件
norecursedirs = 
    .git
    .pytest_cache
    __pycache__
    venv
    backend/venv
    node_modules
    htmlcov
    .eggs
    *.egg
    build
    dist

# ==================== 其他选项 | Other Options ====================
# 最小 Python 版本
minversion = 7.0

# 控制台输出编码
console_output_style = progress

# 使用更好的断言输出
enable_assertion_pass_hook = true

# doctest 配置（如果需要）
# doctest_optionflags = NORMALIZE_WHITESPACE ELLIPSIS

# ==================== 警告过滤 | Warning Filters ====================
filterwarnings =
    error
    ignore::UserWarning
    ignore::DeprecationWarning
    ignore:.*:RuntimeWarning

